<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Markdown Preview</title>
<style>
body{font-family:helvetica, arial, freesans, clean, sans-serif;color:#333;line-height:1.6;font-size:14px}.markdown-body{line-height:1.6;font-size:14px}.markdown-body > *:first-child{margin-top:0 !important}.markdown-body > *:last-child{margin-bottom:0 !important}.markdown-body a.absent{color:#c00}.markdown-body h1{font-weight:700;-webkit-font-smoothing:antialiased;color:#000;font-size:28px;margin:20px 0 10px;padding:0}.markdown-body h2{font-weight:700;-webkit-font-smoothing:antialiased;color:#000;font-size:24px;border-bottom-color:#ccc;border-bottom-width:1px;border-bottom-style:solid;margin:20px 0 10px;padding:0}.markdown-body h3{font-weight:700;-webkit-font-smoothing:antialiased;font-size:18px;margin:20px 0 10px;padding:0}.markdown-body h4{font-weight:700;-webkit-font-smoothing:antialiased;font-size:16px;margin:20px 0 10px;padding:0}.markdown-body h5{font-weight:700;-webkit-font-smoothing:antialiased;font-size:14px;margin:20px 0 10px;padding:0}.markdown-body h6{font-weight:700;-webkit-font-smoothing:antialiased;color:#777;font-size:14px;margin:20px 0 10px;padding:0}.markdown-body blockquote{color:#777;border-left-color:#ddd;border-left-width:4px;border-left-style:solid;margin:15px 0;padding:0 15px}.markdown-body dl{margin:15px 0;padding:0}.markdown-body table{border-collapse:collapse;margin:15px 0;padding:0}.markdown-body pre{border-radius:3px;border:1px solid #ccc;line-height:19px;overflow:auto;font-size:13px;background-color:#f8f8f8;margin:15px 0;padding:6px 10px}.markdown-body li p.first{display:inline-block}.markdown-body dl dt{font-size:14px;font-style:italic;font-weight:700;margin:15px 0 5px;padding:0}.markdown-body dl dt:first-child{padding:0}.markdown-body dl dd{margin:0 0 15px;padding:0 15px}.markdown-body table tr{border-top-color:#ccc;border-top-width:1px;border-top-style:solid;background-color:#fff;margin:0;padding:0}.markdown-body table tr:nth-child(2n){background-color:#f8f8f8}.markdown-body img{max-width:100%}.markdown-body span.frame{overflow:hidden;display:block}.markdown-body span.frame > span{border:1px solid #ddd;width:auto;overflow:hidden;float:left;display:block;margin:13px 0 0;padding:7px}.markdown-body span.frame span img{float:left;display:block}.markdown-body span.frame span span{color:#333;clear:both;display:block;padding:5px 0 0}.markdown-body span.align-center > span{text-align:center;overflow:hidden;display:block;margin:13px auto 0}.markdown-body span.align-center span img{text-align:center;margin:0 auto}.markdown-body span.align-right > span{text-align:right;overflow:hidden;display:block;margin:13px 0 0}.markdown-body span.align-right span img{text-align:right;margin:0}.markdown-body span.float-left{overflow:hidden;margin-right:13px;float:left;display:block}.markdown-body span.float-left span{margin:13px 0 0}.markdown-body span.float-right{overflow:hidden;margin-left:13px;float:right;display:block}.markdown-body span.float-right > span{text-align:right;overflow:hidden;display:block;margin:13px auto 0}.markdown-body pre > code{border:currentColor;white-space:pre;margin:0;padding:0}.markdown-body .highlight pre{border-radius:3px;border:1px solid #ccc;line-height:19px;overflow:auto;font-size:13px;background-color:#f8f8f8;padding:6px 10px}.markdown-body p,.markdown-body li{margin:15px 0}.markdown-body ul,.markdown-body ol{padding-left:30px;margin:15px 0}.markdown-body > h2:first-child,.markdown-body > h1:first-child,.markdown-body > h1:first-child + h2{border:0 currentColor;padding-top:0;margin-top:0}.markdown-body > h3:first-child,.markdown-body > h4:first-child,.markdown-body > h5:first-child,.markdown-body > h6:first-child{padding-top:0;margin-top:0}.markdown-body h1 + p,.markdown-body h2 + p,.markdown-body h3 + p,.markdown-body h4 + p,.markdown-body h5 + p,.markdown-body h6 + p,.markdown-body ul li > :first-child,.markdown-body ol li > :first-child,.markdown-body dl dt > :first-child,.markdown-body dl dd > :first-child,.markdown-body blockquote > :first-child,.markdown-body table tr th > :first-child,.markdown-body table tr td > :first-child{margin-top:0}.markdown-body ul li > :last-child,.markdown-body ol li > :last-child,.markdown-body dl dt > :last-child,.markdown-body dl dd > :last-child,.markdown-body blockquote > :last-child,.markdown-body table tr th > :last-child,.markdown-body table tr td > :last-child{margin-bottom:0}.markdown-body table tr th,.markdown-body table tr td{border:1px solid #ccc;text-align:left;margin:0;padding:6px 13px}.markdown-body span.align-center,.markdown-body span.align-right{overflow:hidden;clear:both;display:block}.markdown-body code,.markdown-body tt{border-radius:3px;border:1px solid #eaeaea;white-space:nowrap;background-color:#f8f8f8;margin:0 2px;padding:0 5px}.markdown-body pre code,.markdown-body pre tt{border:currentColor;background-color:transparent}span.codelanguage{display:none}
</style>
</head>
<body>
<div class="markdown-body">
<p><a name="Title"></a></p>

<h1 id="Give_Sign_Assembly_Instructions">Give Sign Assembly Instructions</h1>

<p>These instructions outline the steps for assembling the GIVE sign. </p>

<p><a name="Inventory"></a></p>

<h2 id="Inventory">Inventory</h2>

<p><img src="images/in001-givesignfront.png?raw=true" alt="in001-GiveSignFront" title="Give Sign Front">
</p>

<p><img src="images/in002-givesignbackandparts.png?raw=true" alt="in002-GiveSignBackAndParts" title="Give Sign Back and Parts">
</p>

<p>The give sign consists of</p>

<ol>
<li>Four base plates (one for each letter)</li>
<li>Four Letters (G,I,V,E) with LEDs attached</li>
<li>Spark Core and Circut Board (should be attached to &quot;G&quot; base plate)</li>
<li>12V/5A DC Power Supply with 2.1mm male plug. </li>
<li>Spare 4 x 1/2 panhead screws in case they are needed to secure LEDs (not pictured) </li>
</ol>

<hr>

<p><a name="CircuitLayout"></a></p>

<h2 id="Circuit_Layout">Circuit Layout</h2>

<p>The Spark Core is inserted in a socket on a circuit board that is inside the blue enclosure on the &quot;G&quot; base board.  You can flip the clips out to remove the lid.  YOU DO NOT NEED TO OPEN THE ENCLOSURE AS PART OF NORMAL OPERATION.  You only need to open the enclosure to perform actions on the Spark Core.  </p>

<p><img src="images/cir002-layout.png?raw=true" alt="cir002-Layout" title="Layout">
</p>

<ol>
<li>There is a schematic of the circuit at the end of this document: <a href="#CircuitSchematic">Circuit Schematic</a></li>
</ol>

<hr>

<p><a name="tasks"></a></p>

<h2 id="Tasks">Tasks</h2>

<p>The remainder of this document walks you through a number of tasks.</p>

<ol>
<li><a href="#Task1">Assembling the Sign</a></li>
<li><a href="#Task2">Installing the Spark Core Windows USB Driver</a></li>
<li><a href="#Task3">Installing the Spark-CLI</a></li>
<li><a href="#Task4">Configuring WiFi for a Pre-Programmed Spark Core</a></li>
<li><a href="#Task5">Flashing the LEDDOTS Sketch</a></li>
<li><a href="#Task6">Identifying your Spark Core</a></li>
<li><a href="#Task7">Testing the Spark Core</a></li>
</ol>

<hr>

<p><a name="Task1"></a></p>

<h2 id="Assembling_the_Sign">Assembling the Sign</h2>

<p>The sign assembly is pretty simple.  Basically, just connect the base boards together, then connect the letters to the base boards, and finally connect the cables up.  Easy!</p>

<p>FYI, a number of the pictures were taken under a shade tree.  Apologies for the poor picture quality. </p>

<ol>
<li><p>Identify each base board by looking on the bottom:</p>

<p><img src="images/01010-baseboardlabels.png?raw=true" alt="01010-BaseBoardLabels" title="Base Board Labels">
</p></li>
<li><p>Connect the base boards in order (G,I,V,E) using the dowels and holes:</p>

<p><img src="images/01020-baseboarddowels.png?raw=true" alt="01020-BaseBoardDowels" title="Base Board Dowels">
</p></li>
<li><p>Place each letter on it's corresponding base board, again using the dowels and holes:</p>
<blockquote>
<p><strong>Note:</strong> the holes on the base board are off center and CLOSER to the FRONT.  So make sure the front of the letter (with the LED bulbs showing) is closer to the front of the base board. </p>
</blockquote>
<p><img src="images/01030-letterdowels.png?raw=true" alt="01030-LetterDowels" title="letter Dowels">
</p>

<p><img src="images/01040-eattached.png?raw=true" alt="01040-EAttached" title="E Attached">
</p></li>
<li><p>When the bases and Letters are all attached it should look something like this (minus the lit LEDs): </p>

<p><img src="images/in001-givesignfront.png?raw=true" alt="in001-GiveSignFront" title="Give Sign Front">
</p></li>
<li><p><strong>As you work with the connectors, make sure the handle them by the white plastic parts.  DO NOT PULL THE WIRES GOING INTO THE CONNECTORS.  They can be pulled out of the connector.</strong>  </p>

<p><img src="images/01045-molexconnectorusage.png?raw=true" alt="01045-MolexConnectorUsage" title="Molex Connector Usage">
</p></li>
<li><p>Connect the NUMBERED connectors in the back. (&quot;0&quot;,&quot;1&quot;,&quot;2&quot;,&quot;3&quot;)</p>
<blockquote>
<p><strong>Note:</strong> The &quot;letter&quot; connectors (&quot;A&quot;,&quot;B&quot;,&quot;C&quot;,&quot;D&quot; and &quot;E&quot;) are connectors within a letter and do not need to be messed with unless there is a problem.  As mentioned though, if you do feel a need to disconnect and re-connect one, please take care to handle them only by the white plastic of the connector. </p>
</blockquote>
<p><img src="images/01050-connectors.png?raw=true" alt="01050-Connectors" title="Connector Numbers">
</p>

<ul>
<li><strong>0</strong>: Goes from the Spark Core enclosure to the corresponding &quot;0&quot; connector on the &quot;tongue&quot; of the letter &quot;G&quot;.  Route the wires from the Spark Core enclosure through the LED strip wires to help keep it in place. </li>
<li><strong>1</strong>: Goes from the cable leaving the &quot;G&quot; and to the corresponding connector at the bottom of the letter &quot;I&quot;</li>
<li><strong>2</strong>: Goes from the &quot;I&quot; to the corresponding connector at the bottom of the letter &quot;V&quot;</li>
<li><strong>3</strong>: Goes from the &quot;V&quot; to the bottom of the letter &quot;E&quot;</li>
</ul></li>
<li><p>When you are done connecting the wires, attempt to clean the wires up some by tucking them in where you can.  Seeing the wires is part of the &quot;character&quot; of the sign though, so don't worry about trying to hide them altogether.</p></li>
<li><p>The only step that remains is to connect the power supply to the Spark Core.  You can wait to do this until you have configured the Spark Core as described in the following steps.</p></li>
</ol>

<hr>

<p><a name="Task2"></a></p>

<h2 id="Installing_the_Spark_Core_Windows_USB_Driver">Installing the Spark Core Windows USB Driver</h2>

<h3 id="span_stylecolor_090IF_YOU_ALREADY_HAVE_THE_WINDOWS_USB_DRIVER_INSTALLED_YOU_CAN_SKIP_THIS_TASKspan"><span style="color: #090">IF YOU ALREADY HAVE THE WINDOWS USB DRIVER INSTALLED YOU CAN SKIP THIS TASK</span></h3>

<p>The steps covered here are specific to configuring a Spark Core using the Command Line Interface on a Windows machine. If you will be working with the spark core from a Mac or Linux box, you can can refer to the <a href="http://docs.spark.io/" title="Spark.IO Documentation">online documentation</a> for configuring a Spark Core. </p>

<ol>
<li><p>Before you work with the Spark Core on a Windows Machine, you will need to install the Windows USB Driver.  First, you'll need to download the driver from <a href="https://s3.amazonaws.com/spark-website/Spark.zip">https://s3.amazonaws.com/spark-website/Spark.zip</a> . Download the .zip file and extract it to a folder on your computer.  </p>
<blockquote>
<p><strong>Note:</strong> You can also refer to the documentation for <a href="http://docs.spark.io/connect/#connecting-your-core-connect-over-usb">Connecting to the Spark Core via USB</a></p>
</blockquote></li>
<li><p>Connect the Spark Core to your computer via the USB.  <strong><em>Note that due to some poor planning during the circuit board layout, the capacitors will likely prevent you from connecting the cable.  You can tilt the Spark Core up slightly in it's socket (or remove it all together) to make the USB connection.</em></strong>:</p>

<p><img src="images/04005-usbcapacitorblockage.png?raw=true" alt="04005-USBCapacitorBlockage" title="Cap USB Blockage and Spark Core Tilt">
</p></li>
<li><p>Ensure that the Spark Core is in <strong><a href="http://docs.spark.io/connect/#connecting-your-core-listening-mode">&quot;Listening Mode&quot;</a></strong> by confirming that the RGB LED on the board is flashing blue.  If it isn't, <a href="https://vine.co/v/hFHlpBDELeU">hold the <strong>&quot;MODE&quot;</strong> button on the Spark Core for about three seconds until it begins flashing blue</a>:</p>

<p><img src="images/02005-listeningmode.png?raw=true" alt="02005-ListeningMode" title="Listening Mode">
</p></li>
<li><p>Open your computer's <strong>&quot;Device Manager&quot;</strong>.  Under <strong>&quot;Other Devices&quot;</strong> you should see the <strong>&quot;Spark Core with WiFi&quot;</strong>.  Right click on the <strong>&quot;Spark Core with WiFi&quot;</strong> and select <strong>&quot;Update Driver Software...&quot;</strong> from the pop-up menu: </p>

<p><img src="images/02010-sparkinotherdevices.png?raw=true" alt="02010-SparkInOtherDevices" title="Spark in Other Devices">
</p></li>
<li><p>Select the <strong>&quot;Browse my computer for driver software&quot;</strong> option:</p>

<p><img src="images/02020-browse.png?raw=true" alt="02020-Browse" title="Browse">
</p></li>
<li><p>Then browse to the folder where you extracted the Spark.zip file you downloaded previously with the Windows USB driver.  (There should be a <strong>spark_core.inf</strong> and <strong>spark_core.cat</strong> file in the folder), then click <strong>&quot;Next&quot;</strong>:</p>

<p><img src="images/02030-sparkdriverfolder.png?raw=true" alt="02030-SparkDriverFolder" title="Spark Driver Folder">
</p></li>
<li><p>In the <strong>&quot;Windows Security&quot;</strong> window, click <strong>&quot;Install&quot;</strong> to install the driver:</p>

<p><img src="images/02040-install.png?raw=true" alt="02040-Install" title="Install">
</p></li>
<li><p>You should see a confirmation that the <strong>&quot;Spark Core with Wifi and Arduino Compatability&quot;</strong> driver was installed.  Click <strong>&quot;Close&quot;</strong> to close the window. </p>

<p><img src="images/02050-driverinstalled.png?raw=true" alt="02050-DriverInstalled" title="Driver Installed">
</p></li>
<li><p>Finally, back in the <strong>&quot;Device Manager&quot;</strong> you should see the Spark Core listed under <strong>&quot;Ports&quot;</strong>:</p>

<p><img src="images/02060-sparkoncomport.png?raw=true" alt="02060-SparkOnComPort" title="Spark Core on COM Port">
</p></li>
<li><p>At this point, if you were to use a terminal program (Like <a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html">PuTTY</a>) you could connect serially to the Spark Core via the COM port listed (COM4 in this case) and issue <a href="http://docs.spark.io/connect/#connecting-your-core-connect-over-usb">some commands</a>.  However, the Spark Command Line Interface (Spark-CLI) offers significantly more functionality, so we'll use that.  </p></li>
</ol>

<hr>

<p><a name="Task3"></a></p>

<h2 id="Installing_the_Spark-CLI">Installing the Spark-CLI</h2>

<h3 id="span_stylecolor_090IF_YOU_ALREADY_HAVE_THE_LATEST_VERSION_OF_THE_SPARK-CLI_INSTALLED_YOU_CAN_SKIP_THIS_TASKspan"><span style="color: #090">IF YOU ALREADY HAVE THE LATEST VERSION OF THE SPARK-CLI INSTALLED YOU CAN SKIP THIS TASK</span></h3>

<p>The <strong>Spark Command Line Interface (Spark-CLI)</strong> is a <strong>Node.js</strong> application that allows you to manage your spark cores, and the code that runs on them.  The Spark-CLI source is available from GitHub at <a href="https://github.com/spark/spark-cli">https://github.com/spark/spark-cli</a> and you can read the docs here: <a href="http://docs.spark.io/cli/">http://docs.spark.io/cli/</a></p>

<ol>
<li><p>First, ensure that you have Node.js installed.  You can install it from here: <a href="http://nodejs.org/">http://nodejs.org/</a></p>
<blockquote>
<p><strong>Note:</strong> It helps if you let the installer install the Node Package Manager (npm) as well as to add Node to the system path.  If you add node the path, you can use node from any Windows Command Prompt. </p>
</blockquote></li>
<li><p>To install the Spark-CLI using node, you can open a Node.js Command Prompt (or any command administrator prompt if you allowed the Node.js installer to add Node to the path) and issue the following command:</p>

<p><code>npm install -g spark-cli</code></p>

<p><img src="images/03010-installsparkcli.png?raw=true" alt="03010-InstallSparkCLI" title="Install Spark-CLI">
</p></li>
<li><p>This documentation was written with the Spark-CLI version 0.4.1.  If you already have the Spark-CLI installed, you can determine its version using the following command:</p>

<p><code>npm list -g spark-cli</code></p>

<p><img src="images/03020-sparkcliversion.png?raw=true" alt="03020-SparkCliVersion" title="SparkCliVersion">
</p></li>
<li><p>In addition, you can always upgrade to the latest version of the Spark-CLI using the command: </p>

<p><code>npm update -g spark-cli</code></p></li>
</ol>

<hr>

<p><a name="Task4"></a></p>

<h2 id="Configuring_WiFi_for_a_Pre-Programmed_Spark_Core">Configuring WiFi for a Pre-Programmed Spark Core</h2>

<h3 id="span_stylecolor_900_font-weight_boldIF_YOU_ARE_ADDING_YOUR_OWN_SPARK_CORE_OR_NEED_TO_RE-PROGRAM_AN_EXISTING_SPARK_CORE_SKIP_THIS_STEP_AND_GO_TO_a_hrefTask5Flashing_the_LEDDOTS_Sketchaspan"><span style="color: #900; font-weight: bold">IF YOU ARE ADDING YOUR OWN SPARK CORE, OR NEED TO RE-PROGRAM AN EXISTING SPARK CORE, SKIP THIS STEP AND GO TO <a href="#Task5">Flashing the LEDDOTS Sketch</a></span></h3>

<p>If you received the GIVE sign with a Spark Core that has been pre-programmed, you only need to configure the Spark Core to connect to your local WiFi.</p>

<ol>
<li><p>Connect the Spark Core to your PC via USB, and place the Spark Core into <strong>&quot;<a href="http://docs.spark.io/connect/#connecting-your-core-listening-mode">Listening Mode</a>&quot;</strong> by holding down the <strong>&quot;Mode&quot;</strong> button on the spark core until the RGB LED flashes blue repeatedly.</p></li>
<li><p>Open a Node Command Prompt, and issue the following command </p>

<p><code>spark setup wifi</code></p></li>
<li><p>Follow the prompts to configure the Spark Core for your WiFi network.  </p>
<blockquote>
<p><strong>Note:</strong> Some MiFi wifi hot spots (like my Verizon MiFi), and other networks take the user to a start screen on the first load.  If connecting to your mifi, the Spark might fail to connect the first time.  Try cycling the power on your Spark Core to get it to restart and connect.  If the WiFi network you are connecting to requires a browser based authentication process, you won't be able to connect your Spark Core to it.  You must know the WiFi SSID, Security Mode, and Password.  </p>
</blockquote>
<p><img src="images/04010-sparksetupwifi.png?raw=true" alt="04010-SparkSetupWifi" title="spark setup wifi">
</p></li>
<li><p>When the WiFi setup is complete, you should see the RGB LED on the Spark Core &quot;Breathing Cyan&quot;.  This means that <a href="https://vine.co/v/OmOAlMg17Y9">it should have a cyan color (light blue) and should repeatedly fade in and out.</a> </p></li>
</ol>

<hr>

<p><a name="Task5"></a></p>

<h2 id="Flashing_the_LEDDOTS_Sketch">Flashing the LEDDOTS Sketch</h2>

<p>If your Spark Core has not been claimed, you need to do that first. </p>

<p>If the Spark Core you want to claim has already been claimed by another account, you will have to have that account owner remove the core before you can claim it:</p>

<p><code>spark core remove &lt;core name / core id&gt;</code></p>

<p>If your Spark Core is new, or is available to be claimed you can use the Spark-CLI commands:</p>

<pre><code>spark cloud login
spark setup
</code></pre>

<p>You can find instructions for connecting and claiming a core here: <a href="http://docs.spark.io/connect"><a href="http://docs.spark.io/connect">http://docs.spark.io/connect</a></a></p>

<p>The <strong>&quot;LEDDOTS&quot;</strong> sketch (app) we use below is used to drive a spark core that is connected to a string of 30mm LED Dots from Adafruit (<a href="https://www.adafruit.com/products/1547">https://www.adafruit.com/products/1547</a>).  These LED strips provide are a powerful way to create extremely active and colorful visualizations.  The LEDs are controlled using a <a href="http://www.adafruit.com/datasheets/WS2801.pdf">WS2801</a> chip.  It allows a string of LEDs (54 in the case of the GIVE Sign) to be strung together and controlled with only two pins on a Microcontroller. Super cool!</p>

<p>The sketch uses a modified version of the <a href="https://github.com/adafruit/Adafruit-WS2801-Library">Adafruit_WS2801</a> library.  The code has been modified to work with the Spark Core:  <a href="https://gist.github.com/technobly/8339548#file-sparkcorews2801-cpp-L370">https://gist.github.com/technobly/8339548#file-sparkcorews2801-cpp-L370</a> . The modified version of the code was provided via GitHub by <a href="https://github.com/technobly">Technobly</a></p>

<p>The LEDDOTS sketch has two methods, <code>showPercent(string)</code> and <code>setDelay(string)</code>.  The <code>setDelay(string)</code> method is used really more for debugging purposes.  It sets the delay (ms) used by the various animations.  Setting the delay lower speeds up the animations.  However, the default delay is only 5ms so you can't make them much faster.  </p>

<p>The <code>showPercent(string)</code> function is the main purpose of the sketch.  It takes in a string command that has a single integer in it representing a percentange between 0 and 100. </p>

<p>It then uses that displays that percentage as a number of dots in the LED dot stream.  0% = 0 dots, 50% = 27 dots, 100% = 54 dots.  The dots fill with the following pattern:</p>
<blockquote>
<p><strong>Note:</strong> the following picture was taken when the percentage was 48% or 26 dots (rounded up).</p>
</blockquote>
<p><img src="images/05005-dotfillpattern.png?raw=true" alt="05005-DotFillPattern" title="Dot Fill Pattern">
</p>

<p>The color of the &quot;filled&quot; dots will be based on the percentage (note, this may change in the future):</p>

<ul>
<li><p>00 - 92% = Red</p></li>
<li><p>93 - 97% = Yellow</p></li>
<li><p>98 - 100% = Green</p></li>
</ul>

<p>The Spark Core that is shipped with the GIVE sign should already have the LEDDOTS sketch flashed on it, however if you need to program another Spark Core, you can follow these steps:</p>

<ol>
<li><p>Login to the <a href="http://spark.io/build">Spark Build</a> web development environment with your Spark.IO credentials (the same credentials you used to claim your Spark Core): <a href="https://www.spark.io/build">https://www.spark.io/build</a> </p></li>
<li><p>If this isn't your first sketch, clik the <strong>&quot;CREATE NEW APP&quot;</strong> button:</p>

<p><img src="images/05010-createnewapp.png?raw=true" alt="05010-CreateNewApp" title="Create New App">
</p></li>
<li><p>When prompted, enter <strong>&quot;LEDDOTS&quot;</strong> as the name for your new app:</p>

<p><img src="images/05020-leddotsappname.png?raw=true" alt="05020-LEDDOTSAppname" title="LEDDOTS App Name">
</p></li>
<li><p>Paste the following code into the code window:</p>
<blockquote>
<p><strong>Note:</strong> This is a big code piece.  You can also just open the source file at <a href="./LEDDOTS/leddots.ino">LEDDOTS.ino</a>.  Also, while the code file has the arduino <strong>&lowast;.ino</strong> extension, you CAN NOT open and compile this in the Arduino IDE.  </p>
</blockquote>
<span class="codelanguage">C++</span><pre><code class="C++"><span style="color:#008000">//-----------------------------------------------//</span>
<span style="color:#008000">// SPARK CORE Adafruit_WS2801 LIBRARY &amp; EXAMPLE  //</span>
<span style="color:#008000">//===============================================//</span>
<span style="color:#008000">// Copy this into a new application at:          //</span>
<span style="color:#008000">// https://www.spark.io/build and go nuts!       //</span>
<span style="color:#008000">// Read comments in APPLICATION.CPP section for  //</span>
<span style="color:#008000">// Hookup details!                               //</span>
<span style="color:#008000">//-----------------------------------------------//</span>
<span style="color:#008000">// Technobly / BDub - Jan 9th, 2014              //</span>
<span style="color:#008000">//===============================================//</span>
<span style="color:#008000">//</span>
<span style="color:#008000">// NOTE: Library is kind of hacked up at the moment</span>
<span style="color:#008000">// Look for 4 &#39;////&#39; for all areas commented out</span>
<span style="color:#008000">// Will clean up after verified working!</span>
<span style="color:#008000">//</span>
<span style="color:#008000">// YES, I&#39;M SHOUTING! xD</span>

<span style="color:#008000">// Code From: https://gist.github.com/technobly/8339548#file-sparkcorews2801-cpp-L370</span>

<span style="color:#008000">/* ========================== Adafruit_WS2801.h =========================== */</span>

<span style="color:#008000">///#if (ARDUINO &gt;= 100)</span>
<span style="color:#008000">//// #include &lt;Arduino.h&gt;</span>
<span style="color:#008000">///#else</span>
<span style="color:#008000">/// #include &lt;WProgram.h&gt;</span>
<span style="color:#008000">/// #include &lt;pins_arduino.h&gt;</span>
<span style="color:#008000">///#endif</span>

<span style="color:#008000">// Not all LED pixels are RGB order; 36mm type expects GRB data.</span>
<span style="color:#008000">// Optional flag to constructors indicates data order (default if</span>
<span style="color:#008000">// unspecified is RGB).  As long as setPixelColor/getPixelColor are</span>
<span style="color:#008000">// used, other code can always treat &#39;packed&#39; colors as RGB; the</span>
<span style="color:#008000">// library will handle any required translation internally.</span>
#define WS2801_RGB 0
#define WS2801_GRB 1

#define boolean <span style="color:#0000FF">bool</span>

<span style="color:#0000FF">class</span> Adafruit_WS2801 {

 <span style="color:#0000FF">public</span>:

  <span style="color:#008000">// Configurable pins:</span>
  Adafruit_WS2801(uint16_t n, uint8_t dpin, uint8_t cpin, uint8_t order=WS2801_RGB);
  Adafruit_WS2801(uint16_t x, uint16_t y, uint8_t dpin, uint8_t cpin, uint8_t order=WS2801_RGB);
  <span style="color:#008000">// Use SPI hardware; specific pins only:</span>
  Adafruit_WS2801(uint16_t n, uint8_t order=WS2801_RGB);
  <span style="color:#008000">// Empty constructor; init pins/strand length/data order later:</span>
  Adafruit_WS2801();
  <span style="color:#008000">// Release memory (as needed):</span>
  ~Adafruit_WS2801();

  <span style="color:#0000FF">void</span>
     begin(<span style="color:#0000FF">void</span>),
     show(<span style="color:#0000FF">void</span>),
     setPixelColor(uint16_t n, uint8_t r, uint8_t g, uint8_t b),
     setPixelColor(uint16_t n, uint32_t c),
     setPixelColor(uint16_t x, uint16_t y, uint8_t r, uint8_t g, uint8_t b),
     setPixelColor(uint16_t x, uint16_t y, uint32_t c),
     updatePins(uint8_t dpin, uint8_t cpin), <span style="color:#008000">// Change pins, configurable</span>
     updatePins(<span style="color:#0000FF">void</span>), <span style="color:#008000">// Change pins, hardware SPI</span>
     updateLength(uint16_t n), <span style="color:#008000">// Change strand length</span>
     updateOrder(uint8_t order); <span style="color:#008000">// Change data order</span>
  uint16_t
     numPixels(<span style="color:#0000FF">void</span>);
  uint32_t
     getPixelColor(uint16_t n);

 <span style="color:#0000FF">private</span>:

  uint16_t
     numLEDs,
     width,     <span style="color:#008000">// used with matrix mode</span>
     height;    <span style="color:#008000">// used with matrix mode</span>
  uint8_t
     *pixels,   <span style="color:#008000">// Holds color values for each LED (3 bytes each)</span>
     rgb_order, <span style="color:#008000">// Color order; RGB vs GRB (or others, if needed in future)</span>
     clkpin    , datapin,     <span style="color:#008000">// Clock &amp; data pin numbers</span>
     clkpinmask, datapinmask; <span style="color:#008000">// Clock &amp; data PORT bitmasks</span>
  <span style="color:#0000FF">volatile</span> uint8_t
     *clkport  , *dataport;   <span style="color:#008000">// Clock &amp; data PORT registers</span>
  <span style="color:#0000FF">void</span>
     alloc(uint16_t n),
     startSPI(<span style="color:#0000FF">void</span>);
  boolean
     hardwareSPI, <span style="color:#008000">// If &#39;true&#39;, using hardware SPI</span>
     begun;       <span style="color:#008000">// If &#39;true&#39;, begin() method was previously invoked</span>
};

<span style="color:#008000">/* ========================== Adafruit_WS2801.cpp =========================== */</span>

<span style="color:#008000">////#include &quot;SPI.h&quot;</span>
<span style="color:#008000">////#include &quot;Adafruit_WS2801.h&quot;</span>

<span style="color:#008000">// Example to control WS2801-based RGB LED Modules in a strand or strip</span>
<span style="color:#008000">// Written by Adafruit - MIT license</span>
<span style="color:#008000">/*****************************************************************************/</span>

<span style="color:#008000">// Constructor for use with hardware SPI (specific clock/data pins):</span>
Adafruit_WS2801::Adafruit_WS2801(uint16_t n, uint8_t order) {
  rgb_order = order;
  alloc(n);
  updatePins();
}

<span style="color:#008000">// Constructor for use with arbitrary clock/data pins:</span>
Adafruit_WS2801::Adafruit_WS2801(uint16_t n, uint8_t dpin, uint8_t cpin, uint8_t order) {
  rgb_order = order;
  alloc(n);
  updatePins(dpin, cpin);
}

<span style="color:#008000">// Constructor for use with a matrix configuration, specify w, h for size of matrix</span>
<span style="color:#008000">// assumes configuration where string starts at coordinate 0,0 and continues to w-1,0, w-1,1</span>
<span style="color:#008000">// and on to 0,1, 0,2 and on to w-1,2 and so on. Snaking back and forth till the end.</span>
<span style="color:#008000">// other function calls with provide access to pixels via an x,y coordinate system</span>
Adafruit_WS2801::Adafruit_WS2801(uint16_t w, uint16_t h, uint8_t dpin, uint8_t cpin, uint8_t order) {
  rgb_order = order;
  alloc(w * h);
  width = w;
  height = h;
  updatePins(dpin, cpin);
}

<span style="color:#008000">// Allocate 3 bytes per pixel, init to RGB &#39;off&#39; state:</span>
<span style="color:#0000FF">void</span> Adafruit_WS2801::alloc(uint16_t n) {
  begun   = <span style="color:#0000FF">false</span>;
  numLEDs = ((pixels = (uint8_t *)calloc(n, 3)) != NULL) ? n : 0;
}

<span style="color:#008000">// via Michael Vogt/neophob: empty constructor is used when strand length</span>
<span style="color:#008000">// isn&#39;t known at compile-time; situations where program config might be</span>
<span style="color:#008000">// read from internal flash memory or an SD card, or arrive via serial</span>
<span style="color:#008000">// command.  If using this constructor, MUST follow up with updateLength()</span>
<span style="color:#008000">// and updatePins() to establish the strand length and output pins!</span>
<span style="color:#008000">// Also, updateOrder() to change RGB vs GRB order (RGB is default).</span>
Adafruit_WS2801::Adafruit_WS2801(<span style="color:#0000FF">void</span>) {
  begun     = <span style="color:#0000FF">false</span>;
  numLEDs   = 0;
  pixels    = NULL;
  rgb_order = WS2801_RGB;
  updatePins(); <span style="color:#008000">// Must assume hardware SPI until pins are set</span>
}

<span style="color:#008000">// Release memory (as needed):</span>
Adafruit_WS2801::~Adafruit_WS2801(<span style="color:#0000FF">void</span>) {
  <span style="color:#0000FF">if</span> (pixels != NULL) {
     free(pixels);
  }
}

<span style="color:#008000">// Activate hard/soft SPI as appropriate:</span>
<span style="color:#0000FF">void</span> Adafruit_WS2801::begin(<span style="color:#0000FF">void</span>) {
  <span style="color:#0000FF">if</span>(hardwareSPI == <span style="color:#0000FF">true</span>) {
     startSPI();
  } <span style="color:#0000FF">else</span> {
     pinMode(datapin, OUTPUT);
     pinMode(clkpin , OUTPUT);
  }
  begun = <span style="color:#0000FF">true</span>;
}

<span style="color:#008000">// Change pin assignments post-constructor, switching to hardware SPI:</span>
<span style="color:#0000FF">void</span> Adafruit_WS2801::updatePins(<span style="color:#0000FF">void</span>) {
  hardwareSPI = <span style="color:#0000FF">true</span>;
  datapin     = clkpin = 0;
  <span style="color:#008000">// If begin() was previously invoked, init the SPI hardware now:</span>
  <span style="color:#0000FF">if</span>(begun == <span style="color:#0000FF">true</span>) startSPI();
  <span style="color:#008000">// Otherwise, SPI is NOT initted until begin() is explicitly called.</span>

  <span style="color:#008000">// Note: any prior clock/data pin directions are left as-is and are</span>
  <span style="color:#008000">// NOT restored as inputs!</span>
}

<span style="color:#008000">// Change pin assignments post-constructor, using arbitrary pins:</span>
<span style="color:#0000FF">void</span> Adafruit_WS2801::updatePins(uint8_t dpin, uint8_t cpin) {

  <span style="color:#0000FF">if</span>(begun == <span style="color:#0000FF">true</span>) { <span style="color:#008000">// If begin() was previously invoked...</span>
     <span style="color:#008000">// If previously using hardware SPI, turn that off:</span>
     <span style="color:#0000FF">if</span>(hardwareSPI == <span style="color:#0000FF">true</span>) SPI.end();
     <span style="color:#008000">// Regardless, now enable output on &#39;soft&#39; SPI pins:</span>
     pinMode(dpin, OUTPUT);
     pinMode(cpin, OUTPUT);
  } <span style="color:#008000">// Otherwise, pins are not set to outputs until begin() is called.</span>

  <span style="color:#008000">// Note: any prior clock/data pin directions are left as-is and are</span>
  <span style="color:#008000">// NOT restored as inputs!</span>

  hardwareSPI = <span style="color:#0000FF">false</span>;
  datapin     = dpin;
  clkpin      = cpin;
  <span style="color:#008000">////clkport     = portOutputRegister(digitalPinToPort(cpin));</span>
  <span style="color:#008000">////clkpinmask  = digitalPinToBitMask(cpin);</span>
  <span style="color:#008000">////dataport    = portOutputRegister(digitalPinToPort(dpin));</span>
  <span style="color:#008000">////datapinmask = digitalPinToBitMask(dpin);</span>
}

<span style="color:#008000">// Enable SPI hardware and set up protocol details:</span>
<span style="color:#0000FF">void</span> Adafruit_WS2801::startSPI(<span style="color:#0000FF">void</span>) {
     SPI.begin();
     SPI.setBitOrder(MSBFIRST);
     SPI.setDataMode(SPI_MODE0);
     SPI.setClockDivider(SPI_CLOCK_DIV128); <span style="color:#008000">// 1 MHz max, else flicker (set to 72MHz/128 = 562.5kHz)</span>
}

uint16_t Adafruit_WS2801::numPixels(<span style="color:#0000FF">void</span>) {
  <span style="color:#0000FF">return</span> numLEDs;
}

<span style="color:#008000">// Change strand length (see notes with empty constructor, above):</span>
<span style="color:#0000FF">void</span> Adafruit_WS2801::updateLength(uint16_t n) {
  <span style="color:#0000FF">if</span>(pixels != NULL) free(pixels); <span style="color:#008000">// Free existing data (if any)</span>
  <span style="color:#008000">// Allocate new data -- note: ALL PIXELS ARE CLEARED</span>
  numLEDs = ((pixels = (uint8_t *)calloc(n, 3)) != NULL) ? n : 0;
  <span style="color:#008000">// &#39;begun&#39; state does not change -- pins retain prior modes</span>
}

<span style="color:#008000">// Change RGB data order (see notes with empty constructor, above):</span>
<span style="color:#0000FF">void</span> Adafruit_WS2801::updateOrder(uint8_t order) {
  rgb_order = order;
  <span style="color:#008000">// Existing LED data, if any, is NOT reformatted to new data order.</span>
  <span style="color:#008000">// Calling function should clear or fill pixel data anew.</span>
}

<span style="color:#0000FF">void</span> Adafruit_WS2801::show(<span style="color:#0000FF">void</span>) {
  uint16_t i, nl3 = numLEDs * 3; <span style="color:#008000">// 3 bytes per LED</span>
  <span style="color:#008000">////uint8_t  bit;</span>

  <span style="color:#008000">// Write 24 bits per pixel:</span>
  <span style="color:#008000">////if(hardwareSPI) {</span>
     <span style="color:#0000FF">for</span>(i=0; i&lt;nl3; i++) {
        SPI.transfer(pixels[i]);
        <span style="color:#008000">////while(!(SPSR &amp; (1&lt;&lt;SPIF)));</span>
     }
     <span style="color:#008000">////</span>
     <span style="color:#008000">/*} else {
     for(i=0; i&lt;nl3; i++ ) {
        for(bit=0x80; bit; bit &gt;&gt;= 1) {
          if(pixels[i] &amp; bit) *dataport |=  datapinmask;
          else                *dataport &amp;= ~datapinmask;
          *clkport |=  clkpinmask;
          *clkport &amp;= ~clkpinmask;
        }
     }
  }*/</span>

  delay(1); <span style="color:#008000">// Data is latched by holding clock pin low for 1 millisecond</span>
}

<span style="color:#008000">// Set pixel color from separate 8-bit R, G, B components:</span>
<span style="color:#0000FF">void</span> Adafruit_WS2801::setPixelColor(uint16_t n, uint8_t r, uint8_t g, uint8_t b) {
  <span style="color:#0000FF">if</span>(n &lt; numLEDs) { <span style="color:#008000">// Arrays are 0-indexed, thus NOT &#39;&lt;=&#39;</span>
     uint8_t *p = &amp;pixels[n * 3];
     <span style="color:#008000">// See notes later regarding color order</span>
     <span style="color:#0000FF">if</span>(rgb_order == WS2801_RGB) {
        *p++ = r;
        *p++ = g;
     } <span style="color:#0000FF">else</span> {
        *p++ = g;
        *p++ = r;
     }
     *p++ = b;
  }
}

<span style="color:#008000">// Set pixel color from separate 8-bit R, G, B components using x,y coordinate system:</span>
<span style="color:#0000FF">void</span> Adafruit_WS2801::setPixelColor(uint16_t x, uint16_t y, uint8_t r, uint8_t g, uint8_t b) {
  boolean evenRow = ((y % 2) == 0);
  <span style="color:#008000">// calculate x offset first</span>
  uint16_t offset = x % width;
  <span style="color:#0000FF">if</span> (!evenRow) {
     offset = (width-1) - offset;
  }
  <span style="color:#008000">// add y offset</span>
  offset += y * width;
  setPixelColor(offset, r, g, b);
}

<span style="color:#008000">// Set pixel color from &#39;packed&#39; 32-bit RGB value:</span>
<span style="color:#0000FF">void</span> Adafruit_WS2801::setPixelColor(uint16_t n, uint32_t c) {
  <span style="color:#0000FF">if</span>(n &lt; numLEDs) { <span style="color:#008000">// Arrays are 0-indexed, thus NOT &#39;&lt;=&#39;</span>
     uint8_t *p = &amp;pixels[n * 3];
     <span style="color:#008000">// To keep the show() loop as simple &amp; fast as possible, the</span>
     <span style="color:#008000">// internal color representation is native to different pixel</span>
     <span style="color:#008000">// types.  For compatibility with existing code, &#39;packed&#39; RGB</span>
     <span style="color:#008000">// values passed in or out are always 0xRRGGBB order.</span>
     <span style="color:#0000FF">if</span>(rgb_order == WS2801_RGB) {
        *p++ = c &gt;&gt; 16; <span style="color:#008000">// Red</span>
        *p++ = c &gt;&gt;  8; <span style="color:#008000">// Green</span>
     } <span style="color:#0000FF">else</span> {
        *p++ = c &gt;&gt;  8; <span style="color:#008000">// Green</span>
        *p++ = c &gt;&gt; 16; <span style="color:#008000">// Red</span>
     }
     *p++ = c;         <span style="color:#008000">// Blue</span>
  }
}

<span style="color:#008000">// Set pixel color from &#39;packed&#39; 32-bit RGB value using x,y coordinate system:</span>
<span style="color:#0000FF">void</span> Adafruit_WS2801::setPixelColor(uint16_t x, uint16_t y, uint32_t c) {
  boolean evenRow = ((y % 2) == 0);
  <span style="color:#008000">// calculate x offset first</span>
  uint16_t offset = x % width;
  <span style="color:#0000FF">if</span> (!evenRow) {
     offset = (width-1) - offset;
  }
  <span style="color:#008000">// add y offset</span>
  offset += y * width;
  setPixelColor(offset, c);
}

<span style="color:#008000">// Query color from previously-set pixel (returns packed 32-bit RGB value)</span>
uint32_t Adafruit_WS2801::getPixelColor(uint16_t n) {
  <span style="color:#0000FF">if</span>(n &lt; numLEDs) {
     uint16_t ofs = n * 3;
     <span style="color:#008000">// To keep the show() loop as simple &amp; fast as possible, the</span>
     <span style="color:#008000">// internal color representation is native to different pixel</span>
     <span style="color:#008000">// types.  For compatibility with existing code, &#39;packed&#39; RGB</span>
     <span style="color:#008000">// values passed in or out are always 0xRRGGBB order.</span>
     <span style="color:#0000FF">return</span> (rgb_order == WS2801_RGB) ?
        ((uint32_t)pixels[ofs] &lt;&lt; 16) | ((uint16_t) pixels[ofs + 1] &lt;&lt;  8) | pixels[ofs + 2] :
        (pixels[ofs] &lt;&lt;  8) | ((uint32_t)pixels[ofs + 1] &lt;&lt; 16) | pixels[ofs + 2];
  }

  <span style="color:#0000FF">return</span> 0; <span style="color:#008000">// Pixel # is out of bounds</span>
}

<span style="color:#008000">/* ========================== Application.cpp =========================== */</span>

<span style="color:#008000">////#include &quot;SPI.h&quot;</span>
<span style="color:#008000">////#include &quot;Adafruit_WS2801.h&quot;</span>

<span style="color:#008000">/*****************************************************************************
Example sketch for driving Adafruit WS2801 pixels on the Spark Core!

  Designed specifically to work with the Adafruit RGB Pixels!
  12mm Bullet shape ----&gt; https://www.adafruit.com/products/322
  12mm Flat shape   ----&gt; https://www.adafruit.com/products/738
  36mm Square shape ----&gt; https://www.adafruit.com/products/683

  These pixels use SPI to transmit the color data, and have built in
  high speed PWM drivers for 24 bit color per pixel
  2 pins are required to interface

  Adafruit invests time and resources providing this open source code, 
  please support Adafruit and open-source hardware by purchasing 
  products from Adafruit!

  Written by Limor Fried/Ladyada for Adafruit Industries.  
  BSD license, all text above must be included in any redistribution

*****************************************************************************/</span>

<span style="color:#008000">// The colors of the wires may be totally different so</span>
<span style="color:#008000">// BE SURE TO CHECK YOUR PIXELS TO SEE WHICH WIRES TO USE!</span>

<span style="color:#008000">// SPARK CORE SPI PINOUTS</span>
<span style="color:#008000">// http://docs.spark.io/#/firmware/communication-spi</span>
<span style="color:#008000">// Spark Core   WS2801</span>
<span style="color:#008000">// VIN       -- +5V</span>
<span style="color:#008000">// A3 (SCK)  -- Green wire on Adafruit Pixels, CI (Clock Input) on strips</span>
<span style="color:#008000">// A5 (MOSI) -- Yellow wire on Adafruit Pixels, DI (Data Input) on strips</span>
<span style="color:#008000">// GND       -- GND</span>

<span style="color:#008000">// Don&#39;t forget to connect the ground wire to Arduino ground,</span>
<span style="color:#008000">// and the +5V wire to a +5V supply</span>

<span style="color:#008000">// Set the argument to the NUMBER of pixels. 25 = 25 pixels in a row</span>
Adafruit_WS2801 strip = Adafruit_WS2801(54,WS2801_RGB);

<span style="color:#008000">// For 36mm LED pixels: these pixels internally represent color in a</span>
<span style="color:#008000">// different format.  Either of the above constructors can accept an</span>
<span style="color:#008000">// optional extra parameter: WS2801_RGB is conventional RGB order</span>
<span style="color:#008000">// WS2801_GRB is the GRB order required by the 36mm pixels.  Other</span>
<span style="color:#008000">// than this parameter, your code does not need to do anything different;</span>
<span style="color:#008000">// the library will handle the format change.  Example:</span>
<span style="color:#008000">//Adafruit_WS2801 strip = Adafruit_WS2801(25, WS2801_GRB);</span>

<span style="color:#008000">// Initialze the pct value for the showPercent() function to 0</span>
<span style="color:#0000FF">int</span> pct = 0;
<span style="color:#008000">// Initialize the delay that will be used when setting pixel colors.</span>
<span style="color:#0000FF">int</span> dly=5;  <span style="color:#008000">//Leave at least some delay in.  It doesn&#39;t appear to work without a delay. </span>

<span style="color:#008000">//Flag to indicate if a showPercentage update is already in progress</span>
<span style="color:#0000FF">bool</span> updating = <span style="color:#0000FF">false</span>;

<span style="color:#0000FF">void</span> setup() {

  strip.begin();

  <span style="color:#008000">// Update LED contents, to start they are all &#39;off&#39;</span>
  strip.show();

  Spark.function(<span style="color:#8B0000">&quot;showPercent&quot;</span>,showPercent);
  Spark.function(<span style="color:#8B0000">&quot;setDelay&quot;</span>,setDelay);

  Serial.begin(9600);
}

<span style="color:#0000FF">void</span> loop() {
  <span style="color:#008000">// Some example procedures showing how to display to the pixels</span>

  <span style="color:#008000">//colorWipe(Color(255, 0, 0), 50);</span>
  <span style="color:#008000">//colorWipe(Color(0, 255, 0), 50);</span>
  <span style="color:#008000">//colorWipe(Color(0, 0, 255), 50);</span>
  <span style="color:#008000">//rainbow(20);</span>
  <span style="color:#008000">//rainbowCycle(20);</span>

}

<span style="color:#0000FF">int</span> setDelay(String delayString) {

  <span style="color:#008000">//get the new delay value from the string</span>
  <span style="color:#0000FF">int</span> newDly = delayString.toInt();
  <span style="color:#008000">//make sure that the delay is at least 1</span>
  dly = max(1,newDly);
  <span style="color:#008000">//make sure the delay is no more than 50</span>
  dly = min(50,dly);

  <span style="color:#0000FF">return</span> dly;

}

<span style="color:#0000FF">int</span> showPercent(String percent)
{

     Serial.print(<span style="color:#8B0000">&quot;percent: &quot;</span>);
     Serial.println(percent);

     <span style="color:#0000FF">int</span> newPct = percent.toInt();

     Serial.print(<span style="color:#8B0000">&quot;newPct: &quot;</span>);
     Serial.println(newPct);

     <span style="color:#0000FF">if</span>(newPct == pct) {
          <span style="color:#0000FF">return</span> 0;
     }

     <span style="color:#0000FF">if</span>(updating) {
        <span style="color:#0000FF">return</span> 0;
     }

     updating = <span style="color:#0000FF">true</span>;

     pct = newPct;

     rainbow(dly);

     colorWipe(Color(255,255,255),dly);
     colorWipe(Color(0,0,0),dly);
     colorWipe(Color(255,255,255),dly);
     colorWipe(Color(0,0,0),dly);
     colorWipe(Color(255,255,255),dly);
     colorWipe(Color(0,0,0),dly);

     <span style="color:#0000FF">int</span> pixels = (<span style="color:#0000FF">int</span>)(strip.numPixels() * (pct / 100.0));
     <span style="color:#0000FF">int</span> pixel;

     Serial.print(<span style="color:#8B0000">&quot;Num pixels: &quot;</span>);
     Serial.println(pixels);

     <span style="color:#008000">//Determine the color based on the percentage</span>
     <span style="color:#008000">//If the pct is less than 98, full red component, otherwise no red component</span>
     <span style="color:#0000FF">int</span> r = (pct &lt; 98) ? 255 : 0;
     <span style="color:#008000">//If the pct &lt;= 92, no green cpt, if it is &lt;= 98, half green component if it is &gt; 98, full green component</span>
     <span style="color:#0000FF">int</span> g = (pct &gt; 92) ? ((pct &gt; 98) ? 255 : 128) : 0;

     uint32_t c = Color(r, g, 0);

     <span style="color:#0000FF">for</span> (pixel=0; pixel &lt; pixels; pixel++) {
          strip.setPixelColor(pixel, c);
          strip.show();
          delay(dly);
      }

     <span style="color:#0000FF">if</span>(pixels &lt; strip.numPixels()) {
          c = Color(128,128,128);
          <span style="color:#0000FF">for</span>(pixel = pixels; pixel &lt; strip.numPixels(); pixel++) {
                strip.setPixelColor(pixel,c);
                strip.show();
                delay(dly);
          }

     }

     updating = <span style="color:#0000FF">false</span>;

     <span style="color:#0000FF">return</span> pct;

}

<span style="color:#0000FF">void</span> rainbow(uint8_t wait) {
  <span style="color:#0000FF">int</span> i, j;

  <span style="color:#0000FF">for</span> (j=0; j &lt; 256; j++) {     <span style="color:#008000">// 3 cycles of all 256 colors in the wheel</span>
     <span style="color:#0000FF">for</span> (i=0; i &lt; strip.numPixels(); i++) {
        strip.setPixelColor(i, Wheel( (i + j) % 255));
     }  
     strip.show();   <span style="color:#008000">// write all the pixels out</span>
     delay(wait);
  }
}

<span style="color:#008000">// Slightly different, this one makes the rainbow wheel equally distributed </span>
<span style="color:#008000">// along the chain</span>
<span style="color:#0000FF">void</span> rainbowCycle(uint8_t wait) {
  <span style="color:#0000FF">int</span> i, j;

  <span style="color:#0000FF">for</span> (j=0; j &lt; 256 * 5; j++) {     <span style="color:#008000">// 5 cycles of all 25 colors in the wheel</span>
     <span style="color:#0000FF">for</span> (i=0; i &lt; strip.numPixels(); i++) {
        <span style="color:#008000">// tricky math! we use each pixel as a fraction of the full 96-color wheel</span>
        <span style="color:#008000">// (thats the i / strip.numPixels() part)</span>
        <span style="color:#008000">// Then add in j which makes the colors go around per pixel</span>
        <span style="color:#008000">// the % 96 is to make the wheel cycle around</span>
        strip.setPixelColor(i, Wheel( ((i * 256 / strip.numPixels()) + j) % 256) );
     }  
     strip.show();   <span style="color:#008000">// write all the pixels out</span>
     delay(wait);
  }
}

<span style="color:#008000">// fill the dots one after the other with said color</span>
<span style="color:#008000">// good for testing purposes</span>
<span style="color:#0000FF">void</span> colorWipe(uint32_t c, uint8_t wait) {
  <span style="color:#0000FF">int</span> i;

  <span style="color:#0000FF">for</span> (i=0; i &lt; strip.numPixels(); i++) {
        strip.setPixelColor(i, c);
        strip.show();
        delay(wait);
  }
}

<span style="color:#008000">/* Helper functions */</span>

<span style="color:#008000">// Create a 24 bit color value from R,G,B</span>
uint32_t Color(byte r, byte g, byte b)
{
  uint32_t c;
  c = r;
  c &lt;&lt;= 8;
  c |= g;
  c &lt;&lt;= 8;
  c |= b;
  <span style="color:#0000FF">return</span> c;
}

<span style="color:#008000">//Input a value 0 to 255 to get a color value.</span>
<span style="color:#008000">//The colours are a transition r - g -b - back to r</span>
uint32_t Wheel(byte WheelPos)
{
  <span style="color:#0000FF">if</span> (WheelPos &lt; 85) {
    <span style="color:#0000FF">return</span> Color(WheelPos * 3, 255 - WheelPos * 3, 0);
  } <span style="color:#0000FF">else</span> <span style="color:#0000FF">if</span> (WheelPos &lt; 170) {
    WheelPos -= 85;
    <span style="color:#0000FF">return</span> Color(255 - WheelPos * 3, 0, WheelPos * 3);
  } <span style="color:#0000FF">else</span> {
    WheelPos -= 170; 
    <span style="color:#0000FF">return</span> Color(0, WheelPos * 3, 255 - WheelPos * 3);
  }
}
</code></pre></li>
<li><p>Click the <strong>&quot;Save&quot;</strong> button (looks like a folder, don't ask me why) to save the sketch:</p>

<p><img src="images/05030-saveapp.png?raw=true" alt="05030-SaveApp" title="Save App">
</p></li>
<li><p>You can the <strong>&quot;Verify&quot;</strong> your sketch:</p>

<p><img src="images/05040-verifysketch.png?raw=true" alt="05040-VerifySketch" title="Verify Sketch">
</p></li>
<li><p>If you have claimed multiple cores with your account, make sure that the correct Spark Core is set as the target by choosing the <strong>&quot;Cores&quot;</strong> option along the left, then clicking on the <strong>&quot;Star&quot;</strong> icon next to the core you want to flash:</p>

<p><img src="images/05050-selectcore.png?raw=true" alt="05050-SelectCore" title="Select Target Core">
</p></li>
<li><p>Finally, you can flash the code to your Spark Core: </p>
<blockquote>
<p><strong>Note:</strong> The Spark Core's LED should blink purple while it is being flashed</p>
</blockquote>
<p><img src="images/05060-flashcode.png?raw=true" alt="05060-FlashCode" title="Flash Code">
</p></li>
<li><p>You know your core is ready when it is once again <strong>&quot;<a href="https://vine.co/v/OmOAlMg17Y9">breathing cyan</a>&quot;</strong></p></li>
</ol>

<hr>

<p><a name="Task6"></a></p>

<h2 id="Identifying_your_Spark_Core">Identifying your Spark Core</h2>

<ol>
<li><p>Before you can call the <strong>&quot;showPercent&quot;</strong> function on your Spark Core, you need to know</p>

<ul>
<li>The Spark Cores Core ID</li>
<li>The Access Token for your account</li>
</ul></li>
</ol>

<p>We'll walk through finding both of these here:</p>

<ol>
<li><p>You can determine your Spark Core's Core ID using the Spark-CLI if it is connected to your PC and <strong>&quot;<a href="https://vine.co/v/OmOAlMg17Y9">breathing cyan</a>&quot;</strong> by issuing the following commands:</p>

<pre><code>spark cloud login
spark cloud list
</code></pre>

<p><img src="images/06010-sparklist.png?raw=true" alt="06010-SparkList" title="Spark List">
</p></li>
<li><p>You can also determine your Spark Core's ID from the <strong>&quot;<a href="htps://spark.io/build">Spark Build</a>&quot;** web interface.  Login to **&quot;<a href="htps://spark.io/build">Spark Build</a>&quot;</strong>, and from the <strong>&quot;Cores&quot;</strong> page, click on the arrow next to your core to see it's Core ID:</p>

<p><img src="images/06020-coreidinbuild.png?raw=true" alt="06020-CoreIDInBuild" title="CoreIDInBuild">
</p></li>
<li><p>Your access token can also be retrieved from the Spark Build web interface.  Click on the <strong>&quot;Settings&quot;</strong> link, and copy your Access Token from there: </p>

<p><img src="images/06030-accesstoken.png?raw=true" alt="06030-AccessToken" title="Access Token">
</p></li>
</ol>

<hr>

<p><a name="Task7"></a></p>

<h2 id="Testing_the_Spark_Core">Testing the Spark Core</h2>

<p>Ok, if you got this far it is assumed that you have a Spark Core connected to a GIVE sign.  You can now disconnect the Spark Core from your computer (disconnect the USB cable), and power it from the 12V/5A DC Power Supply instead.  </p>

<p>We will be using the <strong><a href="http://docs.spark.io/api">Spark REST API</a></strong> to call the <strong>&quot;showPercent&quot;</strong> function published by the <strong>&quot;LEDDOTS&quot;</strong> app we flashed onto the Spark Core. </p>

<p>The REST Api requires that all requests include the <strong>&quot;access_token&quot;</strong> for the account that the Spark Core belongs to, as well as the Spark core's devic ID (Core ID).  Use the instructions in the <strong>&quot;<a href="#Task6">Identifying your Spark Core</a>&quot;</strong> section to retrieve those values if needed. </p>

<p>The <code>showPercent(string)</code> method takes a single string &quot;command&quot; that represents an integer.  The integer is a percent between 0 and 100. </p>

<p>The showPercent function only applies the new value if it is different from the current value.  When a new value is receive it plays an animation (cycles the rainbow colors, then does a chase of white dots) before showing the new value. </p>

<p>The server sends updates to the Spark Core about once every 10 seconds.  Be aware of that when you are testing.  If you set a value using the REST api, it may be subsequently wiped out a an update from the server.  In fact, this is pretty much guaranteed to happen if things are working right. </p>

<p>You can call the <strong>&quot;showPercent&quot;</strong> function on the spark a number of ways:</p>

<ul>
<li>Spark-CLI</li>
<li>Curl</li>
<li>A REST Client Tool</li>
<li>A custom App</li>
</ul>

<p>We will cover the first three here and leave the custom app implementation to you:</p>

<ol>
<li><p>Connect the 12VDC Power Supply to the Spark Core circuit in the enclosure, and wait until it is <strong>&quot;<a href="https://vine.co/v/OmOAlMg17Y9">breathing cyan</a>&quot;</strong>:</p>

<p><img src="images/07010-connectpowersupply.png?raw=true" alt="07010-ConnectPowerSupply" title="Connect Power Supply">
</p></li>
<li><p>To use the Spark-CLI to call the showPercent function on your Spark Core, first make sure you are logged in via the Spark CLI:</p>

<p><code>spark cloud login</code></p>

<p>Then run either:</p>

<p><code>spark call &lt;core id&gt; showPercent 50</code></p>

<p>or </p>

<p><code>spark call &lt;core name&gt; showPercent 50</code></p>

<p>for example: </p>

<p><img src="images/07020-sparkclicall.png?raw=true" alt="07020-SparkCLICall" title="Spark CLI Call">
</p>
<blockquote>
<p><strong>Note:</strong> showPercent returns the percent that was set.  It returns 0 if the new percent is the same as the old percent. Feel free to change the percentage to try different values.  </p>
</blockquote></li>
<li><p>You can also use <a href="http://curl.haxx.se/download.html">curl</a> to test your spark using the following format:</p>

<p><code>curl https://api.spark.io/v1/devices/&lt;core id&gt;/showPercent -k -d access_token=&lt;access token&gt; -d params=&lt;pct&gt;</code></p>

<p>For example:</p>

<p><img src="images/07030-curlcall.png?raw=true" alt="07030-CurlCall" title="Curl Call">
</p></li>
<li><p>Finally, you can also use a REST client like the <strong>&quot;<a href="http://chromerestclient.appspot.com/">Advanced Rest Client</a>&quot;</strong> app for Chrome.</p>

<p><img src="images/07040-restclient.png?raw=true" alt="07040-RestClient" title="REST Client">
</p></li>
<li><p>To create a custom app (A Windows or Windows Phone App, Web App, iOS, Android, etc) you can read up on the <strong>&quot;<a href="http://docs.spark.io/api">Spark REST Api</a>&quot;</strong> and implement your client code accordingly.</p></li>
</ol>

<hr>

<p><a name="CircuitSchematic"></a></p>

<h2 id="Circuit_Schematic">Circuit Schematic</h2>

<p><img src="images/cir001-schematic.png?raw=true" alt="cir001-schematic" title="Schematic">
</p>

</div>
</body>
</html>
